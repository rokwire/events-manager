<!------------------------------------------------------------------------
  Copyright 2020 Board of Trustees of the University of Illinois.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  ------------------------------------------------------------------------>

{% extends "base.html" %}

{% block title %}
  Add a new Event
{% endblock %}

{% block modals %}
<!-- the save Confirmation form -->
<div id="SaveModal" class="modal fade" role="dialog">
 <div class="modal-dialog modal-lg" role="content">
   <!-- Modal content-->
   <div class="modal-content">
     <div class="modal-header">
         <h4 class="modal-title">Confirmation </h4>
         <button type="button" class="close" data-dismiss="modal">&times;</button>
     </div>
     <div class="modal-body">
         <!-- table form here -->
         <div class="form-group row">
             <label class="col-12 col-form-label"><center>You are about to add this event. </center></label>
         </div>
         <div class="offset-md-2 col-md-10">
             <button type="button" class="btn btn-secondary btn-sm-1" data-dismiss="modal">Cancel</button>
             <button type="submit" class="btn btn-primary btn-sm-1">Confirm</button>
         </div>
       </div>
     </div>
   </div>
 </div>
{% endblock %}

{% block content %}
 <!-- filter and select operations -->
  <!-- back to all events button -->
  <form id = "form" action = "{{url_for('user_events.add_new_event')}}" method="POST" enctype="multipart/form-data">
  <div class="media">
    <a class="grey-background-button btn btn-dark" href="{{ url_for('user_events.user_events') }}" role="button">Back To All Events</a>
  </div>
  <!-- form inputs -->
     <article class="media content-section">
       <div class="media-body">
          <h2><a class="article-title">Add A New Event</a></h2>
          <hr class="divider"/>
          <!-- event group -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Group<span style="color: red">*</span> </h5>
            </div>
            <div class="col-sm-9">
              <div class="user-group-menu eventsmanager-dropdown-menu">
                  <input type="text" name="createdByGroupTitle" id="createdByGroupTitle" title="Choose a group for this event." class="form-control  dropdown-menu-inputfield" placeholder="Choose a group for this event." readonly>
                  <input type="hidden" name="createdByGroupId" id="createdByGroupId">
                  <div class="dropdown-line"></div>
                  <div class="dropdown-menu-option">
                      {% for group in groups %}
                            <div onclick="groupDropDownMenuShow('createdByGroupTitle', '{{group['title']}}', 'createdByGroupId', '{{group['id']}}')" class="usergroup-display-none dropdown-menu-option-item menu-item-text"> {{group['title']}} </div>
                        {% endfor %}
                  </div>
              </div>
            </div>
          </div>
          <!-- event title -->
          <div class="form-group row ">
            <label class="col-12 col-sm-2 form-control-label">
              <h5>Event Title<span style="color: red">*</span> </h5>
            </label>
            <div class="col-sm-9">
              <input class="form-control text-input-field" type="text" id="title" name="title" placeholder="Add a title that describes the event in a few words." required/>
            </div>
          </div>
          <!-- event url -->
          <div class="form-group row ">
            <label class="col-12 col-sm-2 form-control-label">
              <h5>Event URL</h5>
            </label>
            <div class="col-sm-9">
              <input class="form-control text-input-field" type="url" id="titleURL" name="titleURL" placeholder="If there is a URL with additional event information, add it here."/>
            </div>
          </div>
          <!-- event category -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Category<span style="color: red">*</span></h5>
            </div>
            <div class="col-sm-9">
            <!-- customized drop-down menu for category -->
              <div class="category-menu eventsmanager-dropdown-menu">
                <input type="text" id="dropdownmenu-category" name="category" class="form-control dropdown-menu-inputfield" placeholder="Choose an event category" readonly>
                  <div class="dropdown-line"></div>
                  <div class="dropdown-menu-option">
                      {% for key in eventTypeValues %}
                            <div onclick="dropDownMenuShow('dropdownmenu-category', '{{key}}')" class="category-display-none dropdown-menu-option-item menu-item-text"> {{key}} </div>
                      {% endfor %}
                  </div>
              </div>
            </div>
          </div>
          <!-- subcategory -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
                <div class="mytooltip"><h5>Subcategory</h5>
                    <span class="mytooltiptext">Subcategories are currently available only for Athletics Category.</span>
                </div>
            </div>
            <div class="col-sm-9">
              <div class="subcategory-menu eventsmanager-dropdown-menu">
                <input type="text" id="dropdownmenu-subcategory" name="subcategory" class="form-control dropdown-menu-inputfield" placeholder="Choose a subcategory (disabled)." readonly>
                  <div class="dropdown-line"></div>
                  <div class="dropdown-menu-option">
                      {% for key in subcategoriesMap['Big 10 Athletics'] %}
                            <div onclick='dropDownMenuShow("dropdownmenu-subcategory", "{{key}}")' class="create-big-10-athletics subcategory-display-none dropdown-menu-option-item menu-item-text"> {{key}} </div>
                      {% endfor %}
                      {% for key in subcategoriesMap['Recreation, Health and Fitness'] %}
                            <div onclick='dropDownMenuShow("dropdownmenu-subcategory", "{{key}}")' class="create-recreation-health-fitness subcategory-display-none dropdown-menu-option-item menu-item-text"> {{key}} </div>
                      {% endfor %}
                  </div>
              </div>
            </div>
          </div>

          <!-- allDay -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>All Day Event</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="allDay" name="allDay"/> Yes
            </div>
          </div>
          <!-- timezones -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Time Zone<span style="color: red">*</span></h5>
            </div>
            <div class="col-sm-9">
               <div class="timezone-menu eventsmanager-dropdown-menu">
                <input type="text" id="dropdownmenu-timezone" name="timezone" placeholder="Choose the event's time zone." class="form-control dropdown-menu-inputfield" placeholder="Choose the event timezone" readonly>
                  <div class="dropdown-line"></div>
                  <div class="dropdown-menu-option">
                      {% for key, value in timezones.items() %}
                            <div onclick="dropDownMenuShow('dropdownmenu-timezone', '{{key}}')" class="timezone-display-none dropdown-menu-option-item menu-item-text"> {{key}} </div>
                      {% endfor %}
                  </div>
               </div>
            </div>
          </div>
          <!-- startDate -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Start Date<span style="color: red">*</span></h5>
            </div>
            <div class="col-sm-6">
              <input class="form-control text-input-field" type="date" id="startDate" name="startDate" max="9999-12-31" style="width:170px; float:left" required/>
              <input class="form-control text-input-field" type="time" id="startTime" name="startTime" style="width:170px; float:left" required/>
            </div>
          </div>
          <!-- endDate -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>End Date<span style="color: red">*</span></h5>
            </div>
            <div class="col-sm-6">
              <input class="form-control text-input-field" type="date" id="endDate" name="endDate" max="9999-12-31" style="width:170px; float:left" required/>
              <input class="form-control text-input-field" type="time" id="endTime" name="endTime"  style="width:170px; float:left" required/>
            </div>
          </div>

          <!-- isVirtual -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Virtual Location?</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="isVirtual" name="isVirtual" onchange="virtualSelectionChanged(this)"/> Yes
            </div>
          </div>

          <!-- Virtual Event URL -->
          <div class="form-group row" id="Virtual Event URL" hidden>
            <div class="col-12 col-sm-2">
              <h5 type='text'>Virtual Event URL</h5>
            </div>
            <div class="col-sm-9">
              <input id="virtualEventUrl" name="virtualEventUrl" class="form-control" type="text"/>
            </div>
          </div>

          <!-- isInPerson -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Physical Location?</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="isInPerson" name="isInPerson" onchange="inPersonSelectionChanged(this)" checked/> Yes
            </div>
          </div>

          <!-- Location Address -->
          <div class="form-group row" id="Location Address">
            <div class="col-12 col-sm-2">
              <h5 type='text'>Location Address</h5>
            </div>
            <div class="col-sm-9">
              <input class="form-control text-input-field" id="location" name="location" type="text" placeholder="Add the event location's complete address or a description of the location."/>
            </div>
          </div>

          <!-- Script to handle changing header -->
          <script>
              function groupDropDownMenuShow(title, titlevalue, id, idvalue) {
                  if(document.getElementById(id).value != idvalue) {
                      document.getElementById("submit-data").disabled = false;
                  }
                  document.getElementById(id).value = idvalue
                  if(document.getElementById(title).value != titlevalue) {
                      document.getElementById("submit-data").disabled = false;
                  }
                  document.getElementById(title).value = titlevalue
                  document.getElementById(title).classList.add("dropdown-menu-inputfield-selected")
              }
              function dropDownMenuShow(id, value) {
                  if(document.getElementById(id).value != value) {
                      document.getElementById("submit-data").disabled = false;
                  }
                  const oldValue = document.getElementById(id).value
                  document.getElementById(id).value = value
                  if(document.getElementById('dropdownmenu-category').value != "Big 10 Athletics" && document.getElementById('dropdownmenu-category').value != "Recreation, Health and Fitness") {
                      document.getElementById('dropdownmenu-subcategory').placeholder = "Choose an event subcategory (disabled) ..."
                      document.getElementById('dropdownmenu-subcategory').value = "Choose an event subcategory (disabled) ..."
                      document.getElementById('dropdownmenu-subcategory').value = ""
                  }
                  if(document.getElementById('dropdownmenu-category').value == "Big 10 Athletics") {
                      document.getElementById('dropdownmenu-subcategory').placeholder = "Choose an event subcategory"
                  }
                  if(document.getElementById('dropdownmenu-category').value == "Recreation, Health and Fitness" ) {
                      document.getElementById('dropdownmenu-subcategory').placeholder = "Choose an event subcategory"
                  }
                  if(document.getElementById('dropdownmenu-category').value == "Big 10 Athletics" && oldValue == "Recreation, Health and Fitness") {
                      document.getElementById('dropdownmenu-subcategory').value = ""
                  }
                  if(document.getElementById('dropdownmenu-category').value == "Recreation, Health and Fitness" && oldValue == "Big 10 Athletics") {
                      document.getElementById('dropdownmenu-subcategory').value = ""
                  }
                  document.getElementById(id).classList.add("dropdown-menu-inputfield-selected")
              }
              class Dropdownmenu {
                  constructor(selector, display) {
                      this.menu = document.querySelector(selector)
                      this.display = display
                  }
                  onclick() {
                     let self = this
                     this.menu.onclick = function() {
                         if(document.getElementById('dropdownmenu-category').value != "Big 10 Athletics" && document.getElementById('dropdownmenu-category').value != "Recreation, Health and Fitness" && self.display == ".subcategory-display-none") {
                            $(self.display).css({"display": "none"});
                            return;
                         } else if(document.getElementById('dropdownmenu-category').value == "Big 10 Athletics"){
                             document.getElementById('dropdownmenu-subcategory').placeholder = "Choose an event subcategory ..."
                         } else if(document.getElementById('dropdownmenu-category').value == "Recreation, Health and Fitness"){
                             document.getElementById('dropdownmenu-subcategory').placeholder = "Choose an event subcategory ..."
                         }

                         self.menu.classList.toggle('active')
                         if (self.menu.classList.contains('active')) {
                             self.menu.children[0].classList.remove("dropdown-menu-inputfield-selected")
                              Array.from($(self)[0].menu.children)
                                 .filter(child => child.classList.contains("dropdown-line"))[0].style.display = "inherit"
                              $(self.display).css({"display": "block"})
                              Array.from($(self)[0].menu.children)
                                 .filter(function (child) {
                                     if (child.classList.contains("dropdown-menu-option")) {
                                         const children = child.children;
                                         for (let i = 0; i < children.length; i++) {
                                            if(document.getElementById('dropdownmenu-category').value == "Big 10 Athletics" && children[i].classList.contains('create-recreation-health-fitness')) {
                                                children[i].style.display = "none";
                                            }else if (document.getElementById('dropdownmenu-category').value == "Recreation, Health and Fitness" && children[i].classList.contains('create-big-10-athletics')) {
                                                children[i].style.display = "none";
                                            }
                                         }
                                     }
                                 })
                         } else {
                              Array.from($(self)[0].menu.children)
                                 .filter(child => child.classList.contains("dropdown-line"))[0].style.display = "none"
                              $(self.display).css({"display": "none"})
                         }
                     };
                  }
              }
              subcategorymenu = new Dropdownmenu('.subcategory-menu', '.subcategory-display-none')
              subcategorymenu.onclick()
              usergroupmenu = new Dropdownmenu('.user-group-menu', '.usergroup-display-none')
              usergroupmenu.onclick()
              categorymenu = new Dropdownmenu('.category-menu', '.category-display-none')
              categorymenu.onclick()
              timezonemenu = new Dropdownmenu('.timezone-menu', '.timezone-display-none')
              timezonemenu.onclick()
            function virtualSelectionChanged(element) {
              if (element.checked) {
                  document.getElementById('Virtual Event URL').hidden = false;
              } else {
                  if (document.getElementById('isInPerson').checked === false) {
                      element.checked = true;
                      alert("Either one of Physical Location? or Virtual Location? checkboxes need to be checked.")
                  } else {
                      document.getElementById('Virtual Event URL').hidden = true;
                      document.getElementById('virtualEventUrl').value = '';
                  }
              }
            }
            function inPersonSelectionChanged(element) {
              if (element.checked) {
                  document.getElementById('Location Address').hidden = false;
              } else {
                  if (document.getElementById('isVirtual').checked === false) {
                      element.checked = true;
                      alert("Either one of Physical Location? or Virtual Location? checkboxes need to be checked.")
                  } else {
                    document.getElementById('Location Address').hidden = true;
                    document.getElementById('location').value = '';
                  }
              }
            }
          </script>
          <!-- target audience -->
<!--          <div class="form-group row ">-->
<!--            <div class="col-12 col-sm-2">-->
<!--              <h5>Target Audience </h5>-->
<!--            </div>-->
<!--            <div class="col-sm-9">-->
<!--              <div class="form-group">-->
<!--                <select multiple id="targetAudience" name="targetAudience" class="selectpicker" title="Audience">-->
<!--                  {% for key in targetAudienceMap %}-->
<!--                    <option value = "{{key}}" id = {{key}}>{{key}}</option>-->
<!--                  {% endfor %}-->
<!--                </select>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->

          <!-- isGroupPrivate -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Private Event</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="isGroupPrivate" name="isGroupPrivate"/> Yes
            </div>
          </div>

          <!-- freeEvent -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Free Event</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="isEventFree" name="isEventFree"/> Yes
            </div>
          </div>
       
          <!-- cost -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Cost Description</h5>
            </div>
            <div class="col-sm-9">
              <input class="form-control text-input-field" type="text" name="cost" placeholder="Details about the cost associated with this event or expected donations, etc. (if any)"/>
            </div>
          </div>
          <!-- contacts -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Contacts </h5>
            </div>
            <div class="col-sm-9">
              <span role="button" class="add-a-contact add-one btn">Add Contact <img src="{{url_for('static',filename = 'icon-add.svg')}}" class="icon-add"></span>
            </div>
          </div>

          <!-- HIDDEN DYNAMIC ELEMENT -->
          <div class="contact-group dynamic-element" style="display:none">
            <!-- contact fields : first&lastName + email + phone -->
            <div class = "form-group row" >
              <div class="col-sm-3 offset-sm-2">
                <input class="form-control text-input-field" id="firstName" name="firstName" type="text"  pattern="[A-Za-z0-9]{1,20}" placeholder="First Name" />
              </div>
              <div class="col-sm-3">
                <input class="form-control text-input-field" id="lastName" name="lastName" type="text"  pattern="[A-Za-z0-9]{1,20}" placeholder="Last Name"/>
              </div>
               <div class="col-sm-3">
                <input class="form-control text-input-field" id="contactEmail" name="email" type="email" placeholder="Email"/>
              </div>
            </div>
            <div class = "form-group row" >
              <!-- contact fields : first&lastName + email + phone -->
              <div class="col-sm-3 offset-sm-2">
                <input class="form-control text-input-field" id="contactPhone" name="phone" type="text" pattern="^\+?\d{10,13}" placeholder="Phone (10 to 13 digits)"/>
              </div>
               <div class="col-sm-3">
                <input class="form-control text-input-field" id="organization" name="organization" type="text" placeholder="Organization"/>
              </div>
              <!-- End of fields-->
              <div class="col-md-1">
                <span role="button" class="delete btn btn-outline-dark btn-sm-1">Delete</span>
              </div>
            </div>
          </div>
          <!-- END OF HIDDEN ELEMENT -->
          <div class="dynamic-stuff">
            <!-- existing stuff-->
            <!-- none -->
          </div>

          <!-- tags -->
          <meta id="availableTags" data-tags="{{tags}}">
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Tags </h5>
            </div>
                <div class="col-sm-9">
                    <input id="tags" name="tags" class="form-control text-input-field" type="text" placeholder="Start typing to select and add one or more keyword tags related to this event.">
                </div>
          </div>

          <!-- sponsor -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Sponsor </h5>
            </div>
            <div class="col-sm-9">
              <input class="form-control text-input-field" type="text" id="sponsor" name="sponsor" placeholder="Add the name of the person or organization conducting this event. "/>
            </div>
          </div>

          <!-- description -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Description </h5>
            </div>
            <div class="col-12 col-sm-9" style="margin-bottom: 50px">
                <div name = "htmlDescription" id="htmlDescription" class="form-control"></div>
                <input type="hidden" name="longDescription" id="longDescription">
            </div>
          </div>

          <!-- event image -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Event Image </h5>
            </div>
            <div class="col-sm-9">
              <div class="input-group mb-3">
                <div class="custom-file">
                  <input type="file" accept={{extensions}} class="custom-file-input" name = "file" id="file" data-toggle="popover" data-trigger="manual" data-placement="bottom" data-content="Failed to upload. Only support no larger than {{ size_limit }} MB">
                  <label class="custom-file-label" for="file">Choose an image (Max file size {{ size_limit }} MB).</label>
                </div>
                <div class="input-group-append">
                  <button title="Delete event image" class="btn btn-outline-danger delete-image" type="button" id="inputGroupFileAddon04">Delete</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Image preview -->
          <div class="form-group row" id = "image-display" style="display: none;">
          <div class="col-12 col-sm-2"></div>
          <div class="col-sm-9">
            <img id = "preview-image" src = "" style = "max-width: 600px; max-height: 337px;"/>
          </div>
          </div>

          <!-- registration url -->
          <div class="form-group row ">
            <label class="col-12 col-sm-2 form-control-label">
              <h5>Registration URL</h5>
            </label>
            <div class="col-sm-9">
              <input class="form-control text-input-field" type="url" id="registrationURL" name="registrationURL" placeholder="Add a link to the event registration page (if any)."/>
            </div>
          </div>

          <!-- registration label -->
          <div class="form-group row ">
            <label class="col-12 col-sm-2 form-control-label">
              <h5>Registration Label</h5>
            </label>
            <div class="col-sm-9">
              <input class="form-control text-input-field" id="registrationLabel" name="registrationLabel" placeholder="Add a text label to display on the event registration button (e.g., Register Here!)."/>
            </div>
          </div>

          <!-- displayOnlyWithSuperEvent  -->
          <div class="form-group row ">
            <div class="col-12 col-sm-2">
              <h5>Display Only with Super Event</h5>
            </div>
            <div class="col-sm-1">
              <input class="form_control" type="checkbox" id="displayOnlyWithSuperEvent" name="displayOnlyWithSuperEvent"/> Yes
            </div>
          </div>

          <!-- super event check box -->
          <div class="form-group row" id="super-check" onclick="display_super_event_description()">
            <div class="col-12 col-sm-2">
                <div class="mytooltip"><h5>Super Event</h5>
                    <span class="mytooltiptext">A super event is a large event made up of multiple smaller events. For example, a conference with multiple sessions for presentations, tutorials, workshops, etc., is an excellent example of a super event. In this example, the conference will be the super event, and the individual sessions will be the sub-events.</span>
                </div>
            </div>
            <div class="col-12 col-sm-2">
                <input class="form_control" name="isSuperEvent" type="checkbox" id="super-event"> Yes
            </div>
          </div>

          <!-- add sub-event-->
          <div id="super-des" class="form-group" style="display:none" >
            <div class="form-group row">
              <div class="col-12 col-sm-2 form-group"  id="super-des-title"  >
{#                  <h5>Add Sub-Event </h5>#}
                <div class="mytooltip"><h5>Add Sub-Event</h5>
                    <span class="mytooltiptext">A sub-event is a smaller event that's part of a larger super event (e.g., a conference). You can link any existing event created through the Rokwire Events Manager as a sub-event to a super event. The only exceptions are other existing super events and sub-events and the current event. The hierarchy of super events and sub-events go only for one level.</span>
                </div>
              </div>

              <div class="col-sm-9">
                <span role="button" class="add-a-contact add-sub btn">Link Sub-Event <img src="{{url_for('static',filename = 'icon-add.svg')}}" class="icon-add"></span>
              </div>
            </div>
          </div>

           <div class="form-group sub-group dynamic-element-sub" style="display:none">
                <div class = "form-group row" >
                      <div class="form-group col-sm-3 offset-sm-2">
                            <input class="form-control text-input-field search-id" name="name" type="text" placeholder="Sub-Event Title" />
                            <input class="form-control text-input-field" type="hidden" name="id" placeholder=''>
                            <input class="form-control text-input-field" type="hidden" name="eventId" placeholder=''>
                            <input class="form-control text-input-field" type="hidden" name="status" placeholder=''>
                      </div>
                      <div class="col-sm-3 form-group" >
                        <input class="form-control text-input-field" id="track" name="track" type="text" placeholder="Track"/>
                      </div>
                      <div class="form-group dropdown show">
                          <div class="form-group">
                            <select class="form-control offset-sm-2" id="isFeatured" name = "isFeatured">
                              <option>Featured</option>
                              <option>Not Featured</option>
                            </select>
                          </div>
                      </div>
                    <div class="offset-sm-1">
                        <span role="button" class="delete-sub btn btn-outline-dark form-control btn-sm-1">Unlink</span>
                    </div>
                </div>
            </div>

           <div id="sub-current" class="dynamic-stuff-sub">
                <!-- existing sub-events-->
                <!-- none -->
           </div>
        </div>
     </article>

  <!-- cancel/submit button groups -->
  <div class="row justify-content-center">
   <div role="toolbar" aria-label="Toolbar with button groups">
     <div class="btn-group mr-2" role="group" aria-label="first group">
       <a class="white-background-button" href="{{ url_for('user_events.user_events') }}" role="button">Cancel</a>
     </div>
     <div class="btn-group mr-2" role="group" aria-label="Second group">
       <button id="submit-data" class="orange-background-button" type="submit" >Add </button>
     </div>
   </div>
  </div>
</form>

{% endblock %}

<!-- js script for select list in form -->
{% block scripts %}
  {{super()}}
   <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

   <script>
    var quill = new Quill('#htmlDescription', {
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'link'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        ]
      },
      placeholder: 'Add a detailed event description, including as many details as possible.',
      theme: 'snow'  // or 'bubble'
    });

    $('#submit-data').on('click', () => {
    // Get HTML content
    var html = quill.root.innerHTML;

    // Copy HTML content in hidden form
    $('#longDescription').val( html )
})

     //Set the save button disabled in default
     $('#form')
         .each(function(){
             $(this).data('serialized', $(this).serialize())
         })
         .on('change input', function(){
             $(this)
                 .find('input:submit, button:submit')
                     .prop('disabled', $(this).serialize() == $(this).data('serialized'))
             ;
          })
         .find('input:submit, button:submit')
             .prop('disabled', true)
     ;
     //only allow subcategory to be choose when the category is Athletics
     $('#form select[name="category"]').on("change", function(event) {
       if(event.target.value != "Big 10 Athletics"){
         $('#subcategory').prop("disabled", true);
         $('#subcategory').prop("title", "Choose an event subcategory (disabled) ...");
         $('#subcategory-placeholder').text('Choose an event subcategory (disabled) ...');
         $('#subcategory-placeholder').prop('selected', true)
       }else{
         $('#subcategory').prop("disabled", false);
         $('#subcategory').prop("title", "Choose an event subcategory ...");
         $('#subcategory-placeholder').text('Choose an event subcategory ...');
         $('#subcategory-placeholder').prop('selected', true)
       }
     })

     //change back to utc time on submit
     // Commenting out below code. Doing conversion in Python code.
     {#var myform = document.getElementById('form');#}
     {#myform.onsubmit = function(){#}
     {#  var start_local = document.getElementById('startDate').value.replace("T", " ");#}
     {#  var start_utc = new Date(start_local).toISOString();#}
     {#  document.getElementById('startDate').value = start_utc.replace("Z", "").replace(".000", "");#}
     {##}
     {#  var end_local = document.getElementById('endDate').value.replace("T", " ");#}
     {#  var end_utc = new Date(end_local).toISOString();#}
     {#  document.getElementById('endDate').value = end_utc.replace("Z", "").replace(".000", "");#}
     {#;#}

    //Clone the hidden element and shows it
   $('.add-one').click(function(){
     $('.dynamic-element').first().clone().appendTo('.dynamic-stuff').show();
     attach_delete();
   });

   $('.exist-contact').ready(function(){
     attach_delete();
   });

   $("document").ready(function(){
        $('#timezone').prop('value', 'US/Central');
        if (document.getElementById("super-event").checked === true) {
          document.getElementById('displayOnlyWithSuperEvent').disabled = true;
          document.getElementById('displayOnlyWithSuperEventBox').hidden = true;
        }
   })
   //Attach functionality to delete buttons
   function attach_delete(){
     $('.delete').off();
     $('.delete').click(function(){
       console.log("click");
       $(this).closest('.contact-group').remove();
       $('#form').find('input:submit, button:submit').prop("disabled", false);
     });
   }

    //Super event checkbox
   function display_super_event_description(){
     var check = document.getElementById("super-event");
     var sub = document.getElementById("super-des");
     var subCurrent = document.getElementById("sub-current");
     if (check.checked == true){
        document.getElementById('displayOnlyWithSuperEvent').checked = false;
        document.getElementById('displayOnlyWithSuperEvent').disabled = true;
        document.getElementById('displayOnlyWithSuperEventBox').hidden = true;
        sub.style.display = "block";
        subCurrent.style.display = "block";
     } else {
        document.getElementById('displayOnlyWithSuperEvent').disabled = false;
        document.getElementById('displayOnlyWithSuperEventBox').hidden = false;
        sub.style.display = "none";
        subCurrent.style.display = "none";
     }
   }

   //Clone the hidden element and shows it for sub-event
   $('.add-sub').click(function(){
     $('.dynamic-element-sub').first().clone().appendTo('.dynamic-stuff-sub').show();
     attach_delete_sub();
     attach_sub_search();
   });

   $('.exist-sub').ready(function(){
     attach_delete_sub();
   });

   //Attach functionality to delete buttons for sub-event
   function attach_delete_sub(){
     $('.delete-sub').off();
     $('.delete-sub').click(function(){
       console.log("click");
       $(this).closest('.sub-group').remove();
       $('#form').find('input:submit, button:submit').prop("disabled", false);
     });
   }

   //Attach functionality to sub-event-id search
   function attach_sub_search() {
    $(".search-id").autocomplete(
      {
        minLength: 2,
        source: function(request, response) {
          $.ajax({
            url: "{{ url_for('user_events.searchsub') }}"+"?data="+request.term,
            type:"GET",
            dataType: "json",
            success: function(data) {
              response($.map(data, function(item){
                return {
                  label: item.label + " (Category:" +item.category + ", StartDate: " + item.startDate + ")",
                  value : item.label,
                  data: item
                }
              }))
            }
          });
        },
        select: function (event, ui){
          selectedItemData = ui.item.data;
          id_input = $(event.target).next('input')
          id_input.val(selectedItemData.value)
          if ('status' in selectedItemData)
            if (selectedItemData.status === 'pending') {
                event_id_input = id_input.next('input')
                event_id_input.val(selectedItemData.eventId)
                status_input = event_id_input.next('input')
                status_input.val(selectedItemData.status)
            }
        }
      }
    );
   }

    //Clone the hidden element and shows it for tags
   /*
   $('.add-tag').click(function(){
     $('.dynamic-element-tags').first().clone().appendTo('.dynamic-stuff-tags').show();
     attach_delete_tags();
   });

   $('.exist-tags').ready(function(){
     attach_delete_tags();
   });

   //Attach functionality to delete buttons for tags
   function attach_delete_tags(){
     $('.delete-tag').off();
     $('.delete-tag').click(function(){
       $(this).closest('.tag-group').remove();
       $('#form').find('input:submit, button:submit').prop("disabled", false);
     });
   }
   */
   // Handle all-day event
    $("#allDay").change(function () {
      /*
      let $startDate = $("#startDate");
      let $endDate = $("#endDate");

      let startDate = moment($startDate.val());
      let endDate = moment($endDate.val());
      */
      if (this.checked) {
        document.getElementById('startTime').setAttribute("hidden","hidden");
        document.getElementById('startTime').removeAttribute("required");
        document.getElementById('endTime').setAttribute("hidden","hidden");
        document.getElementById('endTime').removeAttribute("required");
        /*
        $endDate.attr("type", "date");
        $startDate.attr("type", "date");
        console.log($startDate.val())
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1;
        var yyyy = today.getFullYear();
        if(dd<10){
          dd='0'+dd
        }
        if(mm<10){
          mm='0'+mm
        }
        date = yyyy+'-'+mm+'-'+dd;
        $startDate.val(startDate.format("YYYY-MM-DD"));
        $endDate.val(endDate.format("YYYY-MM-DD"));
        if ($startDate.val() != ""){
          document.getElementById("endDate").setAttribute("min", $startDate.val());

        } else {
          document.getElementById("endDate").setAttribute("min", date);
        }
      */
      } else {
        document.getElementById('startTime').removeAttribute("hidden");
        document.getElementById('startTime').setAttribute("required", "required");
        document.getElementById('endTime').removeAttribute("hidden");
        document.getElementById('endTime').setAttribute("required", "required");
        /*$startDate.attr("type", "datetime-local");
        $endDate.attr("type", "datetime-local");

        $startDate.val(startDate.format("YYYY-MM-DDTHH:mm"));
        $endDate.val(endDate.hour(23).minute(59).format("YYYY-MM-DDTHH:mm"));
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1;
        var yyyy = today.getFullYear();
        if(dd<10){
          dd='0'+dd
        }
        if(mm<10){
          mm='0'+mm
        }
        date = yyyy+'-'+mm+'-'+dd;
        var dateTime = date+'T'+'00:00:00';
        if ($startDate.val() != ""){
          document.getElementById("endDate").setAttribute("min", $startDate.val());

        } else {
          document.getElementById("endDate").setAttribute("min", date);
        }*/
      }
    });

    // Handle endDate constraint based on the choice of startDate
    $('#startDate').change(function(){
      var start = $('#startDate').val()
      document.getElementById("endDate").setAttribute("min", start)
      var end = $('#endDate').val()
      if (end < start){
        $('#endDate').val(null)
      }
    })

    // Handle image upload and preview
    $('input[type="file"]').change(function(input){
        //console.log("detect image change");
        if (input.target.files && input.target.files[0]) {
          var size = (input.target.files[0].size / 1024 / 1024).toFixed(4)
          if(size > {{ size_limit }}){
            $('input[type="file"]').popover('show');
            $('input[type="file"]').val(null)
            setTimeout(function(){ $('input[type="file"]').popover('hide'); }, 2000);
          } else {
            $('input[type="file"]').popover('hide');
            document.getElementById("image-display").style = "";
            var fileName = input.target.files[0].name;
            $('.custom-file-label').html(fileName);
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#preview-image')
                    .attr('src', e.target.result);
            };
            reader.readAsDataURL(input.target.files[0]);
          }
        }
    });

    // delete button for image upload
    $('.delete-image').click(function() {
      console.log("click the image delete button")
      document.getElementById("image-display").style.display = "none";
      $('.custom-file-label').html('');
      $("#file").val(null);
      $('#preview-image').attr('src', '');
    });

    // set the min value of startDate and endDate to be current time as the default behavior
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1;
    var yyyy = today.getFullYear();
    if(dd<10){
      dd='0'+dd
    }
    if(mm<10){
      mm='0'+mm
    }
    date = yyyy+'-'+mm+'-'+dd;
    var dateTime = date+'T'+'00:00:00';
    document.getElementById("endDate").setAttribute("min", dateTime);

    const availableTags = (new Function("return " + $('#availableTags').data("tags") + ";")());
    function split( val ) {
      return val.split( /,\s*/ );
    }
    function extractLast( term ) {
      return split( term ).pop();
    }

    $( "#tags" ).on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        minLength: 0,
        source: function( request, response ) {
          // delegate back to autocomplete, but extract the last term
          response( $.ui.autocomplete.filter(
            availableTags, extractLast( request.term ) ) );
        },
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          // remove the current input
          terms.pop();
          // add the selected item
          terms.push( ui.item.value );
          // add placeholder to get the comma-and-space at the end
          terms.push( "" );
          this.value = terms.join( ", " );
          return false;
        }
      });
   </script>
{% endblock %}

{% block styles %}
{{ super() }}
<!-- Theme included stylesheets -->
<link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="//cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">
<link href="//cdn.quilljs.com/1.3.6/quill.core.css" rel="stylesheet">
<link href="cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css" rel="stylesheet">
<link href="cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" rel="stylesheet">
<style>
#htmlDescription {
  font-size: 18px;
  overflow-y: visible;
}

  .mytooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.mytooltip .mytooltiptext {
  visibility: hidden;
  width: max-content;
  max-width: 1000px;
  background-color: #343a40;
  color: #fff;
  {#text-align: center;#}
  border-radius: 6px;
  padding: 10px;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.mytooltip:hover .mytooltiptext {
  visibility: visible;
}

.ui-autocomplete {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  display: none;
  float: left;
  min-width: 160px;
  padding: 5px 5px;
  margin: 2px 0 0;
  list-style: none;
  font-size: inherit;
  font-family: inherit;
  text-align: left;
  background-color: #ffffff;
  border: 1px solid #cccccc;
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 4px;
  -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
  background-clip: padding-box;
}

.ui-autocomplete > li > div {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 1.42857143;
  color: #333333;
  white-space: nowrap;
}

.ui-state-hover,
.ui-state-active,
.ui-state-focus {
  text-decoration: none;
  color: #262626;
  background-color: #f5f5f5;
  cursor: pointer;
}

.ui-helper-hidden-accessible {
  border: 0;
  clip: rect(0 0 0 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}
</style>
{% endblock %}
