{% extends 'base.html' %}

{% from 'events/confirmation.html' import confirmation %}

{% block header %}
<h1>{% block title %}{{title}}{% endblock %}</h1>
{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{url_for('event.source', sourceId=source[0])}}">{{source[1]}}</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{title}}</li>
  </ol>
</nav>

<h1 class="text-center">{{title}}</h1>

{% if calendarStatus == "approved" %}
{{ confirmation("disapprove", title) }}
{% else %}
{{ confirmation("approve", title) }}
{% endif %}

<div class="container-fluid">
  <div class="row mt-3 mb-3">
    <div class="col text-center">
      {% if calendarStatus == "approved" %}
      <button type="button" class="btn btn-success" data-toggle="modal" data-target="#confirmModal">Approved</button>
      {% else %}
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#confirmModal">Approve</button>
      {% endif %}
    </div>
  </div>

  <div class="row row-content mt-3 mb-3">
    <div class="col-12 col-sm-1 order-sm-first">
      <h4>Show</h4>
    </div>
    <!--  checkbox group -->
    <div class="form-check form-check-inline">
      <input type="checkbox" class="form-check-input" id="materialInline1" {% if "approved" in select_status %}checked{%endif%}>
      <label class="form-check-label" for="materialInline1">Approved</label>
    </div>
    <div class="form-check form-check-inline">
        <input type="checkbox" class="form-check-input" id="materialInline2" {% if "disapproved" in select_status %}checked{%endif%}>
        <label class="form-check-label" for="materialInline2">Disapproved</label>
    </div>
    <div class="form-check form-check-inline">
        <input type="checkbox" class="form-check-input" id="materialInline3" {% if "published" in select_status %}checked{%endif%}>
        <label class="form-check-label" for="materialInline3">Published</label>
    </div>
    <div class="form-check form-check-inline col-sm-3">
      <input type="checkbox" class="form-check-input" id="materialInline4" {% if "pending" in select_status %}checked{%endif%}>
      <label class="form-check-label" for="materialInline4">Pending</label>
    </div>
    <!-- Search form -->
      <div class="md-form mt-0">
        <input class="form-control" type="text" placeholder="Search Events..." aria-label="Search">
      </div>
      <div class="col-12 col-sm-1 order-sm-last">
        <button type="button" class="btn btn-outline-primary">Search</button>
      </div>
  </div>
</div>

<div id = "accordion">
  {% for post in posts %}
      <div class="card">
        <div class="card-header" role="tab" id = "head">
        <h3 class="mb-0">
            <!-- <a data-toggle="collapse" data-target="#{{post._id}}" href="{{url_for('event.detail', eventId=post._id) }}">
              {{ post.title }}
            </a> -->
            <a href="{{url_for('event.detail', eventId=post._id) }}" class="btn btn-default ml-auto float-left">
              <h4 class="mb-0">{{ post.title }}</h4>
            </a>
            <!-- delete > button -->
            <!-- <a href="{{url_for('event.detail', eventId=post._id) }}" class="btn btn-default ml-auto float-right">
              <h5>></h5>
            </a> -->
        </h3>

        </div>
        <div role="tabpanel" class="collapse" id="{{post._id}}">
            <div class="card-body">
              <p class="d-none d-sm-block">
                {% autoescape false %}
                {{post.description}}
                {% endautoescape %}
              </p>
            </div>
        </div>
    </div class = "card">
  {% endfor %}
</div class = "accordion">
<br>

{{ pagination.links }}

{% endblock %}

{% block scripts%}
  {{ super() }}
  <script>
    $("#approvebutton").click(function() {
      $.post("{{ url_for('event.approveCalendar') }}",
      {
        "calendarId": {{ calendarId}}
      },
      function(data) {
        if (data == "success") {
          location.reload();
        }
      });
    });

    $("#disapprovebutton").click(function() {
      $.post("{{ url_for('event.disapproveCalendar') }}",
      {
        "calendarId": {{ calendarId}}
      },
      function(data) {
        if (data == "success") {
          location.reload();
        }
      });
    });

    $("#materialInline1, #materialInline2, #materialInline3, #materialInline4").on('click', function() {
      let approved = ( $('#materialInline1').is(':checked') ? 1: 0);
      let disapproved = ( $('#materialInline2').is(':checked') ? 1: 0);
      let published = ( $('#materialInline3').is(':checked') ? 1: 0);
      let pending = ( $('#materialInline4').is(':checked') ? 1: 0);
      $.ajax(
        {
          url: "{{ url_for('event.select', calendarId=calendarId) }}",
          dataType: 'json',
          type    : 'POST',
          data    : {
            approved: approved,
            disapproved: disapproved,
            published: published,
            pending: pending
          },
        }
      ).always(function() {
        // remove page argument to return page 0 when one of the status checkboxes is selected
        let args = location.search.substr(1).split('&');
        for(let i = 0; i < args.length; i++) {
          if (args[i].includes("page")){
            args.splice(i, 1);
          }
        }

        if (args.length > 0 && args[0] != '') {
          newUrl = location.origin+location.pathname+'?'+args.join('&');
        } else {
          newUrl = location.origin+location.pathname;
        }
        location.replace(newUrl);
      });
    })
  </script>
{% endblock %}
